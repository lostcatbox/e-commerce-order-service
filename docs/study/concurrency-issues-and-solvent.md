# 동시성 이슈 발생할 수 있는 구간 정리

## 목차
- 포인트 충전 (PointController)
- 쿠폰 발급 (CouponController)
- 주문 및 결제 처리 (OrderController)

## 내용
### 포인트 충전
#### 동시성 이슈 발생 가능 구간
  - 포인트 충전 요청이 동시에 들어올 때, 동일한 유저의 포인트가 중복 충전될 수 있음
  - 예: 유저 A가 1000포인트를 충전하는 요청을 두 번 동시에 보낼 경우, 실제로는 1000포인트가 충전될 수 있음
#### 해결 방안
  - 데이터베이스 트랜잭션 사용: 포인트 충전 로직을 트랜잭션으로 감싸서 원자성을 보장
  - 낙관적 락(Optimistic Locking) 또는 비관적 락(Pessimistic Locking) 적용: 충전 시점에 데이터의 버전을 확인하거나, 특정 레코드에 락을 걸어 동시 접근을 방지
    **- 낙관적 락 적용 이유 : 충전 요청이 빈번하지 않고, 충돌 가능성이 낮은 경우**

### 쿠폰 발급
#### 동시성 이슈 발생 가능 구간
  - 동일한 쿠폰에 대해 여러 유저가 동시에 발급을 시도할 때, 쿠폰 재고가 요청만큼 차감되지 않은 경우
  - 예: 10명의 유저가 동시에 쿠폰 발급 요청을 보낼 경우, 실제로는 10개의 쿠폰이 발급되어야 하지만, 동시성 문제로 인해 5개만 재고차감이 된 결과
#### 해결 방안
  - 데이터베이스 트랜잭션 사용: 쿠폰 발급 로직을 트랜잭션으로 감싸서 원자성을 보장
  - 낙관적 락(Optimistic Locking) 또는 비관적 락(Pessimistic Locking) 적용: 발급 시점에 재고의 버전을 확인하거나, 특정 레코드에 락을 걸어 동시 접근을 방지
    - **- 비관적 락 적용 이유 : 쿠폰 발급 요청이 빈번하고, 충돌 가능성이 높은 경우, 정합성 중요**

### 주문 및 결제 처리
#### 동시성 이슈 발생 가능 구간
  - 동일한 상품에 대해 여러 유저가 동시에 주문을 시도할 때, 상품 재고가 요청만큼 차감되지 않은 경우
  - 예: 상품 A의 재고가 5개인데, 10명의 유저가 동시에 주문을 시도할 경우, 실제로는 5개의 주문만 성공해야 하지만, 동시성 문제로 인해 7개의 주문이 처리되는 결과
#### 해결 방안
  - 데이터베이스 트랜잭션 사용: 주문 및 결제 로직을 트랜잭션으로 감싸서 원자성을 보장
  - 낙관적 락(Optimistic Locking) 또는 비관적 락(Pessimistic Locking) 적용: 주문 시점에 재고의 버전을 확인하거나, 특정 레코드에 락을 걸어 동시 접근을 방지
    - **비관적 락 적용 이유 : 주문 요청이 빈번하고, 충돌 가능성이 높은 경우, 정합성 중요**
