# 요구사항 목록

- 포인트 잔액 충전
- 포인트 잔액 조회
- 상품 조회
- 주문 + 결제
- 선착순 쿠폰
- 인기 판매 상품 조회



# 유스케이스(API)

## 포인트 유스케이스

- **사용자 ID 및 충전할 금액을 받아 잔액을 충전합니다.**
  - 🔥 기능적 요구사항
    - 유효한 사용자이여야 합니다.
    - 충전 가능 금액 범위(0~2,000,000) 내의 충전할 금액이여야 합니다.
  - 🔋 비기능적 요구사항
    - 같은 사용자 ID에 대해 동시에 **수많은 포인트 충전 요청 시, 정확한 충전 필요**
- **사용자 ID를 통해 해당 사용자의 잔액을 조회합니다.**
  - 🔥 기능적 요구사항
    - 유효한 사용자이여야 합니다.



## 상품 유스케이스

- **상품 ID를 통해 상품 정보(ID, 이름, 가격, 잔여수량) 조회합니다.**
  - 🔥 기능적 요구사항
    - 기존에 등록된 상품ID이여야 합니다.
- **최근 3일간 가장 많이 팔린 상위 5개 상품 정보를 조회합니다.**
  - 🔋 비기능적 요구사항
    - **초당 1만 건 조회를 평균 0.3ms 안에 응답해야 합니다.**
      - 통계 정보를 다루기 위한 기술적 고민이 필요합니다.
        - ReadDB, ViewTable 등 활용 가능



## 선착순 쿠폰 유스케이스

- **사용자에게 선착순 할인 쿠폰 발급합니다.**
  - 🔥 기능적 요구사항
    - 유효한 사용자이여야 합니다.
    - 해당 할인 쿠폰의 재고수량이 남아있어야 합니다.
  - 🔋 비기능적 요구사항
    - 동시에 많은 요청이 들어왔을 때, **정확한 할인 쿠폰 재고 차감 및 사용자에게 할인 쿠폰 발급**해야 합니다.
- **사용자의 보유 쿠폰 목록을 조회합니다.**
  - 🔥 기능적 요구사항
    - 유효한 사용자이여야 합니다.



## 주문 및 결제 유스케이스

- **사용자 ID와 [상품 ID, 수량] 목록을 입력받는 주문 요청을 처리하고 결제를 진행합니다.**
  - **주문처리 시 요구사항**
    - 🔥 기능적 요구사항
      - 유효한 사용자이여야 합니다.
      - 주문 요청 시 **유효한 할인 쿠폰을 함께 제출하면, 전체 주문금액에 대해서 할인 혜택을 부여받는다.**
      - 기존에 상품 ID가 존재해야 합니다.
      - **상품 ID에 대한 재고수량이 충분한 경우에만,** 정상적인 주문이 처리됩니다.
    - 🔋 비기능적 요구사항
      - 동시에 여러 주문이 들어올 경우, **사용자의 미사용된 쿠폰만 사용 가능**해야 합니다.
      - 동시에 여러 주문이 들어올 경우, **각 상품의 재고 차감이 정상적으로 이루어져**, 잘못된 주문이 발생하지 않도록 합니다.
  - **결제 처리 시 요구사항**
    - 🔥 기능적 요구사항
      - **기존에 충전된 포인트 잔액을 기반으로 수행**하며, 결제 성공 시 잔액을 차감합니다.
      - 선착순 쿠폰 할인 적용시, **쿠폰 할인 적용 전 전체 결제 금액 - 쿠폰 할인 금액은 반드시 0 이상** 이여야 합니다.
    - 🔋 비기능적 요구사항
      - 동시에 여러 주문이 들어올 경우, **유저의 보유 잔액에 대한 처리가 정확**해야 합니다.
  - **그 외의 요구사항**
    - 🔥 기능적 요구사항
      - 데이터 분석을 위해 결제 성공 시에 **실시간으로 주문 정보를 데이터 플랫폼(외부)에 전송**합니다.





# 도메인 모델 설계

## 포인트 모델

- 의미
  - 유저별 포인트 모델이다.
- 정책
  - 잔액
    - 최소 잔액 = 0
    - 최대 잔액 = 2,000,000
  - 충전 시
    - 한번 충전 요청 시, **충전가능 금액의 범위는 [1~2,000,000]** 이여야 한다.
    - 기존 잔액 + 충전 요청 금액으로 잔액을 업데이트한다.
    - **기존 잔액 + 충전 요청 금액이 최대 잔액을 초과할 경우, 에러 발생**
  - 사용 시
    - 한번 사용 요청 시, **사용 가능 금액의 범위는 [1~2,000,000]** 이여야 한다.
    - 포인트 사용 요청 금액 - 기존 잔액으로 잔액을 업데이트한다.
    - **포인트 사용 요청 금액 - 기존 잔액은 최소 잔액(0) 보다 작은 경우, 에러발생**
- 필드 구성
  - 사용자 Id
  - 잔액



## 상품 모델

- 의미
  - 판매하는 상품의 정보를 포함한 모델이다.
- 정책
  - 재고량
    - 최소 재고량 = 0
    - 최대 재고량 = 1,000
  - 상품 판매 요청 시
    - 상품 재고량 - 상품 판매량을 계산하여, 재고량을 업데이트한다.
    - **상품 재고량 - 상품 판매량이 최소 재고량보다 작은 경우, 에러발생**
- 필드 구성
  - 상품 Id
  - 상품 설명
  - 판매 금액
  - 재고량



## 주문 모델

- 의미
  - 사용자가 상품 주문 시, 사용되는 주문 모델이다. (=주문서)
- 정책
  - 사용한 쿠폰
    - 사용자 Id
  - 주문 요청 시
    - 주문한 상품 목록을 검사한다.
      - 주문한 상품은 1 개 이상이여야 한다.
      - 주문한 상품량들은 모두 1 이상이여야 한다.
    - 사용한 쿠폰의 사용가능 여부를 검사한다.
    - 주문 상태를 주문 요청됨으로 주문을 생성한다.
  - 주문 결제 완료 시
    - 주문 상태를 주문 결제됨으로 변경한다.
  - 주문 완료 시
    - 주문 상태를 주문 완료됨으로 변경한다.
  - 주문 실패 시
    - 주문 상태를 주문 실패됨으로 변경한다.
- 필드 구성
  - 주문 Id
  - 주문한 사용자 Id
  - 주문한 상품 목록
    - 상품Id
    - 주문한 상품량
  - 주문 상태 [주문 요청됨, 주문 결제됨, 주문 완료됨, 주문 실패됨]
  - 사용한 쿠폰 Id
  - 결제 Id



## 결제 모델

- 의미
  - 주문서에 대한 결제 시, 사용되는 결제 모델이다.
- 정책
  - 결제 요청 시
    - 쿠폰 할인 요청하여, 쿠폰이 적용된 최종 결제 금액을 계산한다.
    - 최종 결제 금액은 0 이상 이여야 한다.
    - 결제 상태를 결제 요청됨으로 결제을 생성한다.
  - 결제 성공 시
    - 결제 상태를 결제 성공됨으로 변경한다.
  - 결제 실패 시
    - 결제 상태를 결제 실패됨으로 변경한다.
- 필드 구성
  - 결제 Id
  - 할인 전 결제 금액
  - 최종 결제 금액
  - 결제 상태 [결제 요청됨, 결제 성공됨, 결제 실패됨]



## 선착순 쿠폰 모델

- 의미
  - 선착순 쿠폰 모델이다.
- 정책
  - 할인 처리 시
    - 쿠폰 사용 가능 여부가 [사용 가능] 일 때만 사용가능하다.
    - 할인 대상 금액 - 쿠폰 할인 금액으로 계산하여, 할인된 금액을 반환한다.
  - 선착순 쿠폰 발급 시
    - 쿠폰 사용 가능 여부가 [사용 가능] 일 때만 사용가능하다.
    - 쿠폰 재고량이 1 감소시킨다.
    - 쿠폰 재고량은 0이하가 될 수 없다.
  - 사용 가능한 상태인지 확인
    - 쿠폰 사용 가능 여부가 [사용 가능] 일 때만 사용가능하다.
- 필드 구성
  - 선착순 쿠폰 Id
  - 쿠폰 설명
  - 쿠폰 할인 금액
  - 쿠폰 재고량
  - 쿠폰 사용 가능 여부 [사용 가능, 사용 불가]



## 유저 쿠폰 모델

- 의미
  - 선착순 쿠폰 발급되면, 생기는 유저 쿠폰의 모델이다.
- 정책
  - 쿠폰 사용 시
    - 선착순 쿠폰 Id이 사용가능한 상태인지 확인한다.
    - 쿠폰 상태가 미사용 인지 확인한다.
    - 쿠폰 상태를 사용으로 변경한다.
- 필드 구성
  - 사용자 Id
  - 선착순 쿠폰 Id
  - 쿠폰 상태 [발급됨, 사용됨]





